---
layout: post
title: Truffle学习笔记
date: 2018-07-12 11:00:00.000000000 +09:00
---

## 安装
```
npm install -g truffle
```

## 快速开始
下载Truffle box中任何的例子项目
```
truffle unbox metacoin
```
项目分为以下几个目录：
+ ``contracts/``: Solidity编写的合约目录
+ ``migrations/``: 部署脚本文件目录
+ ``test/``: 测试项目和合约的文件
+ ``truffles.js``: Truffle配置文件

### 测试
1. Solidity test
```
truffle test ./test/TestMetacoin.sol
```

2. Javascript test
```
truffle test ./test/metacoin.js
```

3. 编译
```
truffle compile
```

### 使用Truffle Develop部署
truffle自带了一条可以用来测试的私链。使用如下命令开启：
1. 开启truffle develop
```
truffle develop
```
然后会展示10个账号（包括对应的私钥），这些账号可以用来同区块链交互

在truffle develop环境中，所有的命令都可以省去前缀``truffle``。比如要执行``truffle compile``,只需要键入``compile``

2. 在区块链上部署编译好的合约
```
migrate
```
结果会输出已经部署好的合约的transactionIDs和地址。

### 使用Ganache部署合约
Ganache是一个可以启动个人私链的应用。使用Ganache部署合约的步骤：
1. 安装Ganache
2. 修改truffle.js
```js
module.export = {
    networks: {
        development: {
            host: "127.0.0.1",
            port: 7545,
            network_id: "*"
        }
    }
}
```
3. 启动Ganache
4. 在终端上，将合约部署在这个通过Ganache生成的区块链上：
```
truffle migrate
```
5. 在Ganache中，点击Transaction按钮，就可以看见交易已经被处理
6. 可以使用truffle console和合约交互，truffle console和truffle develop类似，区别仅仅是truffle console是连接到一个已存在的区块链中的
```
truffle console
```

### 和合约的交互
我们使用``web3.eth.accounts[]``来代表从一些助记符生成的账户。因此，``web3.eth.accounts[0]``就相当于上面开启``truffle develop``生成的第一个地址

1. 检查在合约上metacoin的余额
```js
MetaCoin.deployed().then(function (instance) {
    return instance.getBalance(web3.eth.accounts[0]);
}).then(function (value) {
    return value.toNumber();
});
```
2. 查看余额值多少以太币（该合约中指定一个metacoin值2个以太币）
```js
MetaCoin.deployed().then(function (instance) {
    return instance.getBalanceInEth(web3.eth.accounts[0]); 
}).then(function (value) {
    return value.toNumber();
});
```








